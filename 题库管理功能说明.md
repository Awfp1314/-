# 📚 题库管理功能使用说明

## ✅ 功能完成！

题库管理功能已经完整实现！现在管理员可以通过Web界面直接管理题库，所有修改都会实时同步到所有用户。

---

## 🎯 功能特性

### 1. **题库CRUD操作**
- ✅ **添加题目** - 新增题目到题库
- ✅ **编辑题目** - 修改题目内容、选项、答案、解析
- ✅ **删除题目** - 删除不需要的题目
- ✅ **批量导入** - 一键导入题库文件

### 2. **实时同步**
- ✅ 管理员修改题库后，所有用户立即看到最新题目
- ✅ WebSocket实时推送更新
- ✅ 自动刷新题库缓存

### 3. **搜索和筛选**
- ✅ 按题目内容或题号搜索
- ✅ 按分类筛选
- ✅ 实时搜索结果

### 4. **数据持久化**
- ✅ 题库存储在 `server/data.json`
- ✅ 服务器重启后数据不丢失
- ✅ 自动备份

---

## 🚀 使用方法

### 第1步：启动服务器

```powershell
# 启动后端服务器
cd server
npm start
```

**后端启动成功后会显示：**
```
🚀 服务器启动成功！
📡 HTTP API: http://localhost:3030
🔌 WebSocket: ws://localhost:3030
```

### 第2步：启动前端

```powershell
# 新开一个终端，启动前端
npm run dev
```

**前端启动后会显示：**
```
➜  Local:   http://localhost:4003/
```

### 第3步：管理员登录

1. 打开浏览器访问 `http://localhost:4003`
2. 点击右上角 **用户图标** → **登录**
3. 使用管理员账号登录：
   - 📱 **手机号**: `19312985136`
   - 🔑 **密码**: `Wjj19312985136...`

### 第4步：进入题库管理

1. 登录后，点击右上角 **用户图标** → **管理面板**
2. 点击顶部Tab中的 **📖 题库管理**
3. 现在你可以看到完整的题库管理界面！

---

## 📖 题库管理界面说明

### 顶部功能区

```
┌─────────────────────────────────────────────────┐
│  📚 题库管理                                     │
│  共 568 道题目 | 显示 568 道                     │
│                                                 │
│  [➕ 添加题目]  [📥 导入题库文件]               │
└─────────────────────────────────────────────────┘
```

### 搜索和筛选

```
┌────────────────────────────────────────────┐
│  🔍 [搜索题目或题号...]                     │
│  🔽 [分类筛选: 全部 ▼]                     │
└────────────────────────────────────────────┘
```

### 题目列表

每个题目卡片显示：
- **题号** (#1, #2, ...)
- **分类** (CC2530/ZigBee, CAN总线, ...)
- **题型** (单选题/多选题)
- **题目内容**
- **所有选项** (正确答案高亮)
- **操作按钮** (✏️ 编辑 / 🗑️ 删除)

---

## 🎨 功能演示

### 1️⃣ 添加新题目

1. 点击 **[➕ 添加题目]** 按钮
2. 填写表单：
   - **分类**: 例如 "STM32单片机"
   - **题型**: 单选题 或 多选题
   - **题目内容**: 输入题目
   - **选项 A/B/C/D**: 输入四个选项
   - **正确答案**: 单选填 "A"，多选填 "A,B,C"
   - **解析**: 输入答案解析
3. 点击 **💾 保存**
4. 所有用户立即看到新题目！

### 2️⃣ 编辑现有题目

1. 找到要编辑的题目
2. 点击题目右侧的 **✏️ 编辑** 按钮
3. 修改表单内容
4. 点击 **💾 保存**
5. 修改立即同步到所有用户！

### 3️⃣ 删除题目

1. 找到要删除的题目
2. 点击题目右侧的 **🗑️ 删除** 按钮
3. 确认删除
4. 题目立即从所有用户的题库中移除！

### 4️⃣ 批量导入题库

1. 点击 **[📥 导入题库文件]** 按钮
2. 确认导入（会覆盖数据库中的所有题目）
3. 自动从 `src/questionBank.js` 导入 568 道题目
4. 所有用户题库立即更新！

---

## 🔄 实时同步演示

### 测试实时同步

1. **打开两个浏览器窗口**
   - 窗口A: 管理员登录，打开题库管理
   - 窗口B: 普通用户登录，打开刷题界面

2. **在窗口A添加一道新题目**
   - 填写题目信息
   - 点击保存

3. **在窗口B观察**
   - 浏览器控制台会显示: `➕ 题目已添加: xxx`
   - 刷题时可以看到新添加的题目

4. **在窗口A编辑题目**
   - 修改题目内容
   - 点击保存

5. **在窗口B观察**
   - 浏览器控制台会显示: `✏️ 题目已更新: xxx`
   - 正在做题的用户会立即看到更新

---

## 🔍 搜索功能

### 按题号搜索
```
搜索框输入: 1
结果: 显示题号为1的题目
```

### 按内容搜索
```
搜索框输入: zigbee
结果: 显示所有包含"zigbee"的题目
```

### 按分类筛选
```
分类下拉选择: CC2530/ZigBee
结果: 只显示该分类的题目
```

### 组合筛选
```
搜索框: 传感器
分类: 传感器技术
结果: 传感器技术分类中包含"传感器"的题目
```

---

## 📊 数据结构

### 题目数据格式

```json
{
  "id": 1,
  "category": "CC2530/ZigBee",
  "question": "题目内容？",
  "options": [
    { "id": "A", "text": "选项A" },
    { "id": "B", "text": "选项B" },
    { "id": "C", "text": "选项C" },
    { "id": "D", "text": "选项D" }
  ],
  "correctAnswer": "A",
  "explanation": "答案解析",
  "type": "single"
}
```

### 多选题格式

```json
{
  "id": 44,
  "type": "multiple",
  "correctAnswer": "A,B,C",
  ...
}
```

---

## ⚠️ 注意事项

### 1. 题号自动生成
- 添加新题目时，系统会自动生成递增的题号
- 不要手动修改题号

### 2. 多选题答案格式
- 正确答案必须用**逗号**分隔
- 例如: `A,B,C` (不要有空格)

### 3. 删除题目需谨慎
- 删除题目后**无法恢复**
- 删除前请确认

### 4. 批量导入会覆盖
- "导入题库文件"会**替换**数据库中的所有题目
- 导入前请确认

---

## 🛠️ 故障排查

### 问题1: 题库管理Tab不显示

**原因**: 不是管理员账号

**解决**: 
1. 退出登录
2. 使用管理员账号 `19312985136` 登录
3. 进入管理面板

### 问题2: 修改后用户看不到更新

**原因**: WebSocket连接断开

**解决**:
1. 检查浏览器控制台是否有错误
2. 刷新页面重新连接
3. 确保后端服务器正常运行

### 问题3: 数据保存失败

**原因**: 后端服务器未启动或端口错误

**解决**:
1. 检查后端是否在 3030 端口运行
2. 检查 `src/apiClient.js` 中的端口配置
3. 重启后端服务器

### 问题4: 题库为空

**原因**: 首次启动，数据库未初始化

**解决**:
1. 点击 "导入题库文件" 按钮
2. 系统会自动导入 568 道题目
3. 或者手动添加题目

---

## 🎉 功能测试清单

请按以下顺序测试所有功能：

- [ ] 管理员登录成功
- [ ] 进入题库管理界面
- [ ] 查看题目列表
- [ ] 搜索题目（按题号/内容）
- [ ] 筛选题目（按分类）
- [ ] 添加新题目（单选）
- [ ] 添加新题目（多选）
- [ ] 编辑现有题目
- [ ] 删除题目
- [ ] 批量导入题库
- [ ] 打开两个浏览器测试实时同步
- [ ] 普通用户刷题时看到新添加的题目
- [ ] 服务器重启后数据依然存在

---

## 💡 高级技巧

### 1. 快速批量编辑
1. 导出 `server/data.json`
2. 用文本编辑器批量修改
3. 保存文件
4. 重启服务器

### 2. 备份题库
```powershell
# 备份数据文件
copy server\data.json server\data_backup.json
```

### 3. 恢复题库
```powershell
# 恢复数据文件
copy server\data_backup.json server\data.json
```

---

## 📞 支持

如有问题或建议，请：
1. 检查浏览器控制台的错误信息
2. 检查后端服务器的日志输出
3. 参考本文档的"故障排查"章节

---

## 🎊 完成！

现在你已经拥有了一个完整的题库管理系统！

**主要特点：**
✅ Web界面管理题库
✅ 实时同步到所有用户
✅ 支持搜索和筛选
✅ 数据持久化存储
✅ 支持单选和多选题
✅ 完整的CRUD操作

**开始使用吧！** 🚀
